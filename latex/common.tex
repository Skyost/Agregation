\documentclass[12pt, a4paper]{report}

% LuaLaTeX :

\RequirePackage{iftex}
\RequireLuaTeX

% Packages :

\usepackage[french]{babel}
%\usepackage[utf8]{inputenc}
%\usepackage[T1]{fontenc}
\usepackage[pdfencoding=auto, pdfauthor={Hugo Delaunay}]{hyperref}
\usepackage{amsmath}
\usepackage{amsthm}
%\usepackage{amssymb}
\usepackage{stmaryrd}
\usepackage{tikz}
\usepackage{tkz-euclide}
\usepackage{fourier-otf}
\usepackage{fontspec}
\usepackage{titlesec}
\usepackage{fancyhdr}
\usepackage{catchfilebetweentags}
\usepackage[french, capitalise, noabbrev]{cleveref}
\usepackage[fit, breakall]{truncate}
\usepackage[margin=2.5cm]{geometry}
\usepackage{enumerate}
\usepackage{tocloft}
\usepackage{microtype}
\usepackage{mdframed}
\usepackage{thmtools}
\usepackage{xcolor}
\usepackage{tabularx}
\usepackage{aligned-overset}
\usepackage[subpreambles=true]{standalone}
\usepackage{environ}
\usepackage[normalem]{ulem}
\usepackage{marginnote}
\usepackage{etoolbox}
\usepackage{setspace}
\usepackage[bibstyle=reading, citestyle=draft]{biblatex}
\usepackage{xpatch}

% Bibliographie :

\providecommand{\bibliographypath}{../bibliography.bib}
\addbibresource{\bibliographypath}
\defbibheading{bibliography}[\bibname]{%
	\newpage
	\section*{#1}%
}
\renewbibmacro*{entryhead:full}{\printfield{labeltitle}}
\DeclareFieldFormat{url}{\newline\footnotesize\url{#1}}
\AtEndDocument{\printbibliography}

% Police :

\setmathfont{Erewhon Math}

% Tikz :

\usetikzlibrary{calc}

% Longueurs :

\setlength{\parindent}{0pt}
\setlength{\headheight}{15pt}
\setlength{\fboxsep}{0pt}
\titlespacing*{\chapter}{0pt}{-20pt}{10pt}
\setlength{\marginparwidth}{1.5cm}
\setstretch{1.1}

% Métadonnées :

\author{agreg.skyost.eu}
\date{\today}

% Titres :

\setcounter{secnumdepth}{3}

\renewcommand{\thechapter}{\Roman{chapter}}
\renewcommand{\thesubsection}{\Roman{subsection}}
\renewcommand{\thesubsubsection}{\arabic{subsubsection}}

\titleformat{\chapter}{\huge\bfseries}{\thechapter}{20pt}{\huge\bfseries}
\titleformat*{\section}{\LARGE\bfseries}
\titleformat{\subsection}{\Large\bfseries}{\thesubsection \, - \,}{0pt}{\Large\bfseries}
\titleformat{\subsubsection}{\large\bfseries}{\thesubsubsection. \,}{0pt}{\large\bfseries}

% Table des matières :

\renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}}
\addtolength{\cftsecnumwidth}{10pt}

% Redéfinition des commandes :

\renewcommand*\thesection{\arabic{section}}
\renewcommand{\ker}{\mathrm{Ker}}

% Nouvelles commandes :

\newcommand{\website}{https://agreg.skyost.eu}

\newcommand{\tr}[1]{\mathstrut ^t #1}
\newcommand{\im}{\mathrm{Im}}
\newcommand{\rang}{\operatorname{rang}}
\newcommand{\trace}{\operatorname{trace}}
\newcommand{\id}{\operatorname{id}}
\newcommand{\stab}{\operatorname{Stab}}

\providecommand{\newpar}{\\[\medskipamount]}

\providecommand{\lesson}[3]{%
	\title{#3}%
	\hypersetup{pdftitle={#3}}%
	\setcounter{section}{\numexpr #2 - 1}%
	\section{#3}%
	\fancyhead[R]{\truncate{0.73\textwidth}{#2 : #3}}%
}

\providecommand{\development}[3]{%
	\title{#3}%
	\hypersetup{pdftitle={#3}}%
	\section*{#3}%
	\fancyhead[R]{\truncate{0.73\textwidth}{#3}}%
}

\providecommand{\summary}[1]{%
	\textit{#1}%
	\medskip%
}

%\newcommand{\booklink}[1]{\website/bibliographie\##1}
\newcommand{\citelink}[2]{\hyperlink{cite.\therefsection @#1}{#2}}
\newcommand{\previousreference}{}
\providecommand{\reference}[2][]{%
	\notblank{#1}{\renewcommand{\previousreference}{#1}}{}%
	\marginnote{%
		\centering%
		\notblank{#1}{\cite{[\previousreference]}\\}{}%
		\citelink{\previousreference}{p. #2}%
	}%
}

\newcommand{\imagespath}{../images/}

\providecommand{\includelatexpicture}[1]{%
	\begin{center}%
		\input{\imagespath#1}%
	\end{center}%
	\medskip%
}

\definecolor{devcolor}{HTML}{00695c}
\newcommand{\dev}[1]{%
	\reversemarginpar%
	\marginnote[\bfseries\color{devcolor}\href{\website/developpements/#1}{DEV}]{}%
	\normalmarginpar%
}

% En-têtes :

\pagestyle{fancy}
\fancyhead[L]{\truncate{0.23\textwidth}{\thepage}}
\fancyfoot[C]{\scriptsize \href{\website}{\texttt{agreg.skyost.eu}}}

% Couleurs :

\definecolor{property}{HTML}{fffde7}
\definecolor{proposition}{HTML}{fff8e1}
\definecolor{lemma}{HTML}{fff3e0}
\definecolor{theorem}{HTML}{fce4f2}
\definecolor{corollary}{HTML}{ffebee}
\definecolor{definition}{HTML}{ede7f6}
\definecolor{notation}{HTML}{f3e5f5}
\definecolor{example}{HTML}{e0f7fa}
\definecolor{cexample}{HTML}{efebe9}
\definecolor{application}{HTML}{e0f2f1}
\definecolor{remark}{HTML}{e8f5e9}
\definecolor{demonstration}{HTML}{e1f5fe}

% Théorèmes :

\declaretheoremstyle[bodyfont=\normalfont]{theorem}
\declaretheoremstyle[headfont=\itshape]{remark}

\newcounter{thm}[section]

\newcommand{\newth}[3][style=theorem]{
	\declaretheorem[%
		name=#3,%
		%within=section,
		sibling=thm,%
		mdframed={%
			hidealllines=true,%
			backgroundcolor={#2!98!white},%
			innermargin=8pt,%
			splittopskip=18pt,%
			splitbottomskip=16pt,%
		},%
		#1%
	]{#2}%
}

\newth{property}{Propriété}
\newth{proposition}{Proposition}
\newth{lemma}{Lemme}
\newth{theorem}{Théorème}
\newth{corollary}{Corollaire}
\newth{definition}{Définition}
\newth{notation}{Notation}
\newth{example}{Exemple}
\newth{cexample}{Contre-exemple}
\newth{application}{Application}
\newth[style=remark]{remark}{Remarque}
\newth[style=remark, numbered=no, qed=\textsquare]{demonstration}{Démonstration}

% Environnements :

\NewEnviron{whitetabularx}[1]{%
	\renewcommand{\arraystretch}{2.5}
	\colorbox{white}{%
		\begin{tabularx}{\textwidth}{#1}%
			\BODY%
		\end{tabularx}%
	}%
}

% Maths :

\DeclareFontEncoding{FMS}{}{}
\DeclareFontSubstitution{FMS}{futm}{m}{n}
\DeclareFontEncoding{FMX}{}{}
\DeclareFontSubstitution{FMX}{futm}{m}{n}
\DeclareSymbolFont{fouriersymbols}{FMS}{futm}{m}{n}
\DeclareSymbolFont{fourierlargesymbols}{FMX}{futm}{m}{n}
\DeclareMathDelimiter{\VERT}{\mathord}{fouriersymbols}{152}{fourierlargesymbols}{147}

